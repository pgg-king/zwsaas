var De=Object.defineProperty;var ve=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var ye=(n,u,i)=>u in n?De(n,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[u]=i,ce=(n,u)=>{for(var i in u||(u={}))Oe.call(u,i)&&ye(n,i,u[i]);if(ve)for(var i of ve(u))$e.call(u,i)&&ye(n,i,u[i]);return n};import{_ as fe,s as I,b as Ve,E as ee,F as ue,k as Fe}from"./index.fc627453.js";import{l as te}from"./lodash.28c974ad.js";import"./vue.4c5758a0.js";import{d as Me}from"./vuedraggable.d48fe6d1.js";import{q as be,w as me,p as Le,t as ke,aX as p,Z as x,_ as W,c as l,bd as d,$ as O,aw as q,ax as f,H as oe,aW as le,an as L,R as X,S as $,r as Z,O as Se,a2 as ae,N as xe,u as de,aU as Ie,aT as Re,d as ze,a as Ne,n as Pe,a3 as Be,U as Ue}from"./@vue.87afd1fa.js";import{M as Ce,m as we}from"./ant-design-vue.e954adc4.js";import{_ as je}from"./codemirror-editor-vue3.70a38ba6.js";import"./codemirror.2f37184d.js";import"./js-md5.3cdd41c4.js";import"./@babel.dd651e2b.js";import"./regenerator-runtime.8e24db72.js";import"./vue-router.9a2c52dc.js";import"./js-cookie.31874410.js";import"./spark-md5.2cc5764b.js";import"./@vueuse.67682d36.js";import"./vue-demi.24ed2461.js";import"./axios.e3200588.js";import"./@ant-design.8c82b126.js";import"./@ctrl.fa7cbd46.js";/* empty css                     */import"./dayjs.0743a87f.js";import"./sortablejs.412b554c.js";import"./clipboard.89482ba1.js";import"./markdown-it.39ce48f9.js";import"./entities.0d2c0164.js";import"./uc.micro.981ceb7b.js";import"./mdurl.ef76b4dc.js";import"./linkify-it.92c30060.js";import"./markdown-it-emoji.e3e91710.js";import"./escape-html.e5dfadb9.js";import"./prismjs.169105cf.js";import"./diacritics.6be19c75.js";import"./markdown-it-container.512a5043.js";import"./markdown-it-anchor.c88e5394.js";import"./markdown-it-attrs.3af5ab50.js";import"./markdown-it-table-of-contents.8a4ce16f.js";import"./@kangc.52338b19.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.0ea26897.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./diff-match-patch.bf6a39b5.js";const He={name:"CurdDatabase",components:{draggable:Me},props:{method:Object,visible:Boolean},setup(n,u){const i=be({tables:[],selectedKeys:[],searchTable:"",tableVisible:!1,tableModalRender:null,tableTreeNode:null,tableModalTitle:null});me(()=>i.tableVisible,m=>{u.emit("update:visible",!m)}),z();function e(){i.tableTreeNode=null,i.tableModalTitle="\u6DFB\u52A0\u8868",i.tableModalRender=null,I.post("/ex-admin/plugin-curd-controller-Database/tableForm").then(m=>{i.tableVisible=!0,i.tableModalRender=m,i.tableModalRender.footer=m.content.footer[0],delete i.tableModalRender.content.footer})}function z(){I("ex-admin/plugin-curd-controller-Database/getTable").then(m=>{i.tables=m.data.map(b=>(b.tableName=b.name,b.dataRef=b,b.name=b.id,b.children=[],b.class="table-tree-node",b))})}function G(m){if(i.tableVisible=!1,!m){z();return}return new Promise(b=>{I("ex-admin/plugin-curd-controller-Database/getTableColumn?table="+m.dataRef.id).then(V=>{m.dataRef.children=V.data.map(k=>(k.id=m.id+k.field,k.name=k.field,k.table=m.id,k.parent=m,k.isLeaf=!0,k)),i.tables=[...i.tables],b()})})}function N(m){Ce.confirm({title:"\u5220\u9664\u8868",content:"\u786E\u8BA4\u5220\u9664\u8868\uFF0C\u4E0D\u53EF\u6062\u590D\uFF1F",onOk(){I.delete("/ex-admin/plugin-curd-controller-Database/grid",{data:{ex_admin_action:"delete",ex_admin_sidebar:!0,ids:[m]}}).then(b=>{z()})}})}function S(m,b,V){Ce.confirm({title:"\u5220\u9664\u8868\u5B57\u6BB5",content:"\u786E\u8BA4\u5220\u9664\u8868\u5B57\u6BB5\uFF0C\u4E0D\u53EF\u6062\u590D\uFF1F",onOk(){I.delete("/ex-admin/plugin-curd-controller-Database/grid",{data:{ex_admin_action:"delete",ex_admin_trashed:"false",table:m,ids:[b]}}).then(k=>{G(V)})}})}function R(m,b,V){i.tableTreeNode=V,i.tableModalTitle="\u7F16\u8F91\u5B57\u6BB5",i.tableModalRender=null,I.put("/ex-admin/plugin-curd-controller-Database/form",{table:m,field:b}).then(k=>{i.tableVisible=!0,i.tableModalRender=k,i.tableModalRender.footer=k.content.footer[0],delete i.tableModalRender.content.footer})}function E(){i.tableTreeNode=null,i.tableModalTitle="\u8868\u9884\u8BBE\u5B57\u6BB5",i.tableModalRender=null,I.post("/ex-admin/plugin-curd-controller-Database/presetFields").then(m=>{i.tableVisible=!0,i.tableModalRender=m,i.tableModalRender.footer=m.content.footer[0],delete i.tableModalRender.content.footer})}function T(m){i.tableTreeNode=null,i.tableModalTitle="\u7F16\u8F91\u8868",i.tableModalRender=null,I.post("/ex-admin/plugin-curd-controller-Database/tableForm",{id:m}).then(b=>{i.tableVisible=!0,i.tableModalRender=b,i.tableModalRender.footer=b.content.footer[0],delete i.tableModalRender.content.footer})}function K(m){i.tableModalTitle="\u5173\u8054\u8868(\u6A21\u578B)",i.tableModalRender=null,I.post("/ex-admin/plugin-curd-controller-Database/modelRelationForm",{table:m}).then(b=>{i.tableVisible=!0,i.tableModalRender=b,i.tableModalRender.footer=b.content.footer[0],delete i.tableModalRender.content.footer})}function A(m){i.tableModalTitle="\u6DFB\u52A0\u8868\u5B57\u6BB5",i.tableModalRender=null,I.post("/ex-admin/plugin-curd-controller-Database/form",{table:m}).then(b=>{i.tableVisible=!0,i.tableModalRender=b,i.tableModalRender.footer=b.content.footer[0],delete i.tableModalRender.content.footer})}function P(m,b){b.mouseenter=!0,i.tableTreeNode=b,i.tables=[...i.tables]}function B(m,b){b.mouseenter=!1,i.tables=[...i.tables]}function C(m){m.newIndex!==m.oldIndex&&m.from===m.to&&I.post("ex-admin/plugin-curd-controller-Database/sortField",{table:m.item.__draggable_context.element.table,field:m.item.__draggable_context.element.field,sort:m.newIndex})}const v=Le(()=>i.tables.filter(m=>m.name.indexOf(i.searchTable)>-1||m.comment.indexOf(i.searchTable)>-1));function U(){return document.getElementById("app")}return ce({getModalContainer:U,tableMenus:v,onFieldSort:C,tableMouseenter:P,tableMouseLeave:B,addTableField:A,editTable:T,relationTable:K,presetFields:E,editTableField:R,deleteTableField:S,deleteTable:N,getTable:z,onLoadTable:G,addTable:e},ke(i))}},qe={class:"flex-column"},We={style:{margin:"0 10px 10px 10px"}},Ke=$("\u6DFB\u52A0\u8868"),Ge=$("\u8868\u9884\u8BBE\u5B57\u6BB5"),Je=["onMouseenter","onMouseleave"],Xe={class:"table-tree-title"},Ze=["title"],Qe={key:0,class:"table-tree-action-table"},Ye=["title"],et=["onMouseenter","onMouseleave"],tt={class:"table-tree-title"},nt=["title"],ot={key:0,class:"table-tree-action"},lt=["title"];function at(n,u,i,e,z,G){const N=p("render"),S=p("a-modal"),R=p("a-button"),E=p("reload-outlined"),T=p("a-space"),K=p("a-input"),A=p("FolderOutlined"),P=p("PlusOutlined"),B=p("EditOutlined"),C=p("NodeIndexOutlined"),v=p("DeleteOutlined"),U=p("FileOutlined"),m=p("a-menu-item"),b=p("draggable"),V=p("a-sub-menu"),k=p("a-menu");return x(),W("div",qe,[l(S,{visible:n.tableVisible,"onUpdate:visible":u[1]||(u[1]=y=>n.tableVisible=y),title:n.tableModalTitle,width:"1200px","mask-closable":!1,class:"curd-modal","get-container":e.getModalContainer},{footer:d(()=>[n.tableModalRender?(x(),O(N,{key:0,data:n.tableModalRender.footer},null,8,["data"])):q("",!0)]),default:d(()=>[l(N,{data:n.tableModalRender,onSuccess:u[0]||(u[0]=y=>e.onLoadTable(n.tableTreeNode))},null,8,["data"])]),_:1},8,["visible","title","get-container"]),f("div",We,[l(T,{style:{"margin-bottom":"10px"}},{default:d(()=>[l(R,{onClick:e.addTable},{default:d(()=>[Ke]),_:1},8,["onClick"]),l(R,{onClick:e.presetFields},{default:d(()=>[Ge]),_:1},8,["onClick"]),l(R,{shape:"circle",size:"small",onClick:e.getTable},{icon:d(()=>[l(E)]),_:1},8,["onClick"])]),_:1}),l(K,{value:n.searchTable,"onUpdate:value":u[2]||(u[2]=y=>n.searchTable=y),size:"small",placeholder:"\u641C\u7D22\u8868","allow-clear":""},null,8,["value"])]),l(k,{mode:"inline",class:"curd-table-tree",selectable:!1},{default:d(()=>[(x(!0),W(oe,null,le(e.tableMenus,y=>(x(),O(V,{key:y.id,onTitleClick:g=>e.onLoadTable(y)},{title:d(()=>[f("div",{onMouseenter:g=>e.tableMouseenter(g,y),onMouseleave:g=>e.tableMouseLeave(g,y)},[f("div",Xe,[l(A),f("div",{class:"field-title",title:y.name},L(y.name),9,Ze),y.mouseenter?(x(),W("div",Qe,[l(R,{shape:"circle",size:"small",onClick:X(g=>e.onLoadTable(y),["stop"])},{icon:d(()=>[l(E)]),_:2},1032,["onClick"]),l(R,{shape:"circle",size:"small",onClick:X(g=>e.addTableField(y.id),["stop"])},{icon:d(()=>[l(P)]),_:2},1032,["onClick"]),l(R,{shape:"circle",size:"small",onClick:X(g=>e.editTable(y.id),["stop"])},{icon:d(()=>[l(B)]),_:2},1032,["onClick"]),l(R,{shape:"circle",size:"small",onClick:X(g=>e.relationTable(y.id),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"]),l(R,{shape:"circle",size:"small",onClick:X(g=>e.deleteTable(y.id),["stop"])},{icon:d(()=>[l(v)]),_:2},1032,["onClick"])])):q("",!0)]),f("div",{class:"field-title-desc",title:y.comment},L(y.comment),9,Ye)],40,Je)]),default:d(()=>[l(b,{style:{width:"100%"},list:y.children,onSort:e.onFieldSort,clone:i.method.onClone,onEnd:i.method.onEnd,group:{pull:"clone",put:!1},"item-key":"id"},{item:d(({element:g})=>[f("div",{onMouseenter:J=>e.tableMouseenter(J,g),onMouseleave:J=>e.tableMouseLeave(J,g)},[(x(),O(m,{key:g.id},{default:d(()=>[f("div",tt,[l(U),f("div",{class:"field-title",title:g.name},L(g.name),9,nt),g.mouseenter?(x(),W("div",ot,[l(R,{shape:"circle",size:"small",onClick:X(J=>e.editTableField(y.id,g.field,y),["stop"])},{icon:d(()=>[l(B)]),_:2},1032,["onClick"]),l(R,{shape:"circle",size:"small",onClick:X(J=>e.deleteTableField(y.id,g.field,y),["stop"])},{icon:d(()=>[l(v)]),_:2},1032,["onClick"])])):q("",!0)]),f("div",{class:"field-title-desc",title:g.comment},L(g.comment),9,lt)]),_:2},1024))],40,et)]),_:2},1032,["list","onSort","clone","onEnd"])]),_:2},1032,["onTitleClick"]))),128))]),_:1})])}var it=fe(He,[["render",at],["__scopeId","data-v-158feb82"]]);const Ae=n=>(Ie("data-v-16c0be02"),n=n(),Re(),n),dt={style:{display:"flex"}},rt=Ae(()=>f("span",{style:{"margin-left":"20px"}},"\u5386\u53F2\u8BB0\u5F55",-1)),st=["onClick"],ct={key:0,style:{flex:"1"}},ut={class:"flex"},mt=Ae(()=>f("h4",null,"\u5F53\u524D\u4EE3\u7801",-1)),ft={class:"flex"},bt=$("\u4FDD\u5B58\u5DE6\u4FA7"),pt=$("\u4FDD\u5B58\u53F3\u4FA7"),_t={name:"codeDiff"},ht=Object.assign(_t,{props:{method:Object,code:{type:Object,default:{old:"",new:""}}},setup(n){const u=n,i=be({value:u.code.old,origLeft:u.code.new,connect:"align",theme:"material-ocean",mode:"application/x-httpd-php",lineNumbers:!0,collapseIdentical:!1,highlightDifferences:!0,showDifferences:!0}),e=(C,v)=>{R.value=C},z=Z(!1),G=Z(!0),N=Z("\u751F\u6210\u4EE3\u7801"),S=Z(-1),R=Z(u.code.old),E=Z([]);let T=1;const K=30;me(()=>u.code,C=>{z.value=!0,G.value=!0,i.value=`<?php
`+C.old,R.value=`<?php
`+C.old,i.origLeft=`<?php
`+C.new},{deep:!0}),me(z,C=>{C?(T=1,u.method.getHistory(T,K).then(v=>{E.value=v})):S.value=-1});function A(C){let v=C.target;v.scrollTop+v.clientHeight==v.scrollHeight&&T>0&&(T++,u.method.getHistory(T,K).then(U=>{U.length!=K&&(T=0),E.value=E.value.concat(U)}))}function P(C){G.value=!1,N.value=C.time,C.id==S.value?(N.value="\u751F\u6210\u4EE3\u7801",S.value=-1,i.origLeft=`<?php
`+u.code.new):(S.value=C.id,i.origLeft=`<?php
`+C.code),setTimeout(()=>{G.value=!0})}function B(C){let v;C=="left"?v=i.origLeft.replace(`<?php
`,""):C=="right"&&(v=R.value.replace(`<?php
`,"")),u.method.saveCodeRequest(v).then(()=>{z.value=!1})}return(C,v)=>{const U=p("a-list"),m=p("copy-filled"),b=p("a-button"),V=p("a-space"),k=p("a-modal"),y=Se("copy");return x(),O(k,{title:"\u9884\u89C8\u4EE3\u7801",width:"80%","destroy-on-close":!0,visible:z.value,"onUpdate:visible":v[2]||(v[2]=g=>z.value=g),bodyStyle:{padding:0,paddingTop:"10px"}},{footer:d(()=>[f("div",ft,[l(b,{onClick:v[0]||(v[0]=g=>B("left"))},{default:d(()=>[bt]),_:1}),l(b,{onClick:v[1]||(v[1]=g=>B("right"))},{default:d(()=>[pt]),_:1})])]),default:d(()=>[f("div",dt,[l(U,{class:"history","item-layout":"horizontal","data-source":E.value,onScroll:A},{header:d(()=>[rt]),renderItem:d(({item:g})=>[f("div",{class:ae(["item",S.value==g.id?"active":""]),onClick:J=>P(g)},L(g.time),11,st)]),_:1},8,["data-source"]),G.value?(x(),W("div",ct,[f("div",ut,[l(V,{align:"baseline"},{default:d(()=>[f("h4",null,L(N.value),1),xe((x(),O(b,{shape:"circle",size:"small"},{icon:d(()=>[l(m)]),_:1})),[[y,de(i).origLeft]])]),_:1}),l(V,{align:"baseline"},{default:d(()=>[mt,xe((x(),O(b,{shape:"circle",size:"small",style:{"margin-right":"10px"}},{icon:d(()=>[l(m)]),_:1})),[[y,de(i).value]])]),_:1})]),l(de(je),{merge:!0,options:de(i),height:550,onChange:e},null,8,["options"])])):q("",!0)])]),_:1},8,["visible"])}}});var gt=fe(ht,[["__scopeId","data-v-16c0be02"]]);const vt=ze({name:"ExCurd",components:{CodeDiff:gt,draggable:Me,database:it},setup(n,u){const i=Ve(),e=be({previewCode:{old:"",new:""},searchTable:"",controller:[],controllerIndex:-1,method:[],methodIndex:-1,drawingMain:{component:null,ref:null},componentList:[],controllerForm:null,controllerEditForm:null,methodForm:null,saveConfig:{},methodEditForm:null,settingForm:null,settingFormList:[],databaseDrawerVisible:!1,settingFormVisible:!0,index:-1,isSave:!0,methodTypes:[{value:"grid",label:"\u6570\u636E\u8868\u683C(grid)"},{value:"form",label:"\u8868\u5355(form)"},{value:"detail",label:"\u8BE6\u60C5(detail)"}]}),z=Z(),G=Z();K(),addEventListener("keydown",R),addEventListener("keyup",E),Ne(()=>{removeEventListener("keydown",R),removeEventListener("keyup",E)});let N=0,S=0;function R(o){o.keyCode==17&&(N=1),o.keyCode==83&&(S=1),N==1&&S==1&&y()}function E(o){o.keyCode==17&&(N=0),o.keyCode==83&&(S=0)}function T(){U()}function K(){ne(),I("ex-admin/plugin-curd-controller-Index/getFormComponent").then(o=>{e.componentList=o.data,e.componentList.forEach(a=>{a.options.forEach(t=>{I("ex-admin/plugin-curd-controller-Index/getComponent?type="+t.name).then(r=>{t.component=r.data})})})})}function A(o){["ExForm","ARow","ACol","ExFormMany","ATabPane"].indexOf(o.name)>-1&&!o.content.default&&(o.content.default=[]);for(let a in o.content){let t=o.content,r=[];t[a].forEach(c=>{r.push(c),A(c)}),["ExForm","ARow","ACol","ExFormMany","ATabPane"].indexOf(o.name)>-1&&(a=="default"?o.content[a]=v(o.name,r,o):o.content[a]=r)}}function P(o){return B(o,!0)}function B(o,a=!1){let t;return a?t=o.draggedContext.element.component.name:t=o.draggedContext.element.name,!(t=="ACol"&&o.relatedContext.component.$attrs.group.name!="ARow"||t!="ACol"&&o.relatedContext.component.$attrs.group.name=="ARow")}function C(o,a){o.forEach(t=>{if(typeof t=="object"&&(t.attribute.drawingFormKey&&I({url:"ex-admin/plugin-curd-controller-Index/getDrawingForm",method:"post",data:{key:t.attribute.drawingFormKey}}).then(r=>{t.attribute.drawingForm=JSON.parse(r.data)}),t.content))for(let r in t.content)C(t.content[r])})}function v(o,a,t={}){let r="ex-drag-container";return o=="ARow"?r+=" curd-children-row":o=="ACol"&&(r+=" curd-row-draggable"),C(a),[{name:"DraggableRender",attribute:{group:{name:o,put:!0,pull:!0},animation:1e3,chosenClass:"ex-drag-choose",list:a,tag:o=="ARow"?"render":"div",componentData:{data:t},class:r,style:{width:"100%",minHeight:"32px"},move:c=>B(c)},event:{End:c=>{se(c)},Sort:c=>{e.drawingMain.ref.forceUpdate()},Choose:c=>{document.querySelectorAll("[data-choose]").forEach(M=>{M.removeAttribute("data-choose")}),c.item.setAttribute("data-choose",!0);let s=c.item.__draggable_context.element;s.name==="AFormItem"?e.settingForm=s.content.default[0].attribute.drawingForm:s.name=="DraggableRender"?e.settingForm=s.attribute.componentData.data.attribute.drawingForm:e.settingForm=s.attribute.drawingForm}}}]}const U=te.exports.debounce(V,150);function m(o,a,t,r,c,s,M){o.forEach(_=>{if(_.name=="AFormItem"){if(_.attribute&&_.attribute.name.indexOf("default")>-1){let H=a[_.content.default[0].bindAttribute.value.replace(r+".","")];H===void 0&&(H=a[t[s]]),a[t[s]]=H,t.default=a[t[s]],_.content.default[0].bindAttribute.value=M,_.content.default[0].modelBind.value=M}else if(c.name==="ARangePicker"&&_.attribute.title==="\u9ED8\u8BA4\u503C"){a[t[s]]=a[_.content.default[0].bindAttribute.value.replace(r+".","")],t.default=a[t[s]],_.content.default[0].bindAttribute.value=M,_.content.default[0].modelBind.value=M;const H=c.attribute.startField;c.attribute.startField=r+"."+H.substr(H.indexOf(".")+1);const w=c.attribute.endField;c.attribute.endField=r+"."+w.substr(w.indexOf(".")+1)}}else _.content&&_.content.default&&m(_.content.default,a,t,r,c,s,M)})}function b(o,a=null){o.forEach(t=>{if(typeof t=="object"){if(t.name=="AFormItem"){const r=e.drawingMain.component,c=r.bindAttribute.model,s=r.bind[c];let M=t,_=M.content.default[0],H=_.attribute.drawingForm,w=H.bind[H.bindAttribute.model];for(let h in w)if(h=="title"&&_.name!="ExFormMany")M.attribute.label=w[h];else if(!(["name","default"].indexOf(h)>-1))if(h=="required")M.attribute.required=w[h];else if(h=="field"&&_.name!="ACascader"){let D=c+"."+w[h];a=="ExFormMany"&&(D=w[h]),_.bindAttribute[w.modelValue]=D,_.modelBind[w.modelValue]=D,M.attribute.name=[w[h]],_.name=="ExFormMany"&&s[w[h]]===void 0&&(s[w[h]]=w.default),m(H.content.default,s,w,c,_,h,D)}else if(["character","addonBefore","addonAfter","prefix","suffix"].indexOf(h)>-1&&w[h]){let D=Ue(w[h]);Array.isArray(D)?_.content[h]=D:_.content[h]=[D]}else if(h==="config"){for(let D in w[h])D=="options"&&w[h].options_type==3&&(_.attribute.options=[],Object.assign(_.attribute.options,w[h][D]));if(_.name=="ExSelectTable"){let D="ex-admin/"+w[h].grid_class.replaceAll("\\","-")+"/"+w[h].grid_method,he={};w[h].params&&w[h].params.forEach(ge=>{he[ge.var]=ge.value}),ee(_.attribute,"gridUrl",D),ee(_.attribute,"params",he)}}else ee(_.attribute,h,w[h])}else if(t.name=="DraggableRender")t.attribute.key=ue(20),b(t.attribute.list,t.attribute.group.name);else if(t.name=="ARow"||t.name=="ACol"){let r=t.attribute.drawingForm,c=r.bind[r.bindAttribute.model];delete t.attribute.md,delete t.attribute.sm,delete t.attribute.xs;for(let s in c)ee(t.attribute,s,c[s])}else if(t.name=="ATabs"){let r=t.attribute.drawingForm,c=r.bind[r.bindAttribute.model],s=[],M;c.pane.forEach((H,w)=>{let h=te.exports.cloneDeep(t.content.default[w]);if(h)M=h;else{let D=[];h=te.exports.cloneDeep(M),h.attribute.key=w+1,h.content={default:v("ATabPane",D)}}h.attribute.tab=H.title,s.push(h);for(let D in c)ee(t.attribute,D,c[D])}),t.content.default=s;let _=r.bindAttribute.model+"."+c.modelValue;t.bindAttribute.activeKey=_,t.modelBind.activeKey=_}else if(t.name=="ADivider"){let r=t.attribute.drawingForm,c=r.bind[r.bindAttribute.model];for(let s in c)s=="title"?t.content={default:[c[s]]}:ee(t.attribute,s,c[s])}t.content&&t.content.default&&b(t.content.default)}})}function V(){const o=e.drawingMain.component;let a=o.attribute.drawingForm,t=a.bind[a.bindAttribute.model];if(o.name=="ExForm")Object.assign(o.attribute,t),o.content.default||(o.content.default=[]),b(o.content.default);else if(o.name=="ExGrid"){const r=[];for(let c in t)c=="columns"?(t[c].forEach(s=>{r.push({dataIndex:s.field,title:s.label,type:s.form_type||"",header:{name:"html",attribute:{class:"ex_admin_table_th_name","data-tag":"span"},content:{default:[s.label]}}})}),t.switch.indexOf("hideAction")==-1&&r.push({dataIndex:"ExAdminAction",title:"",header:{name:"html",attribute:{class:"ex_admin_table_th_name","data-tag":"span"},content:{default:[""]}}}),o.attribute.columns=r):c=="switch"?t.swtichOptions.forEach(s=>{o.attribute[s]=t[c].indexOf(s)>-1}):o.attribute[c]=t[c]}else if(o.name=="ADescriptions")for(let r in t)if(r=="items"){const c=[];t[r].forEach(s=>{var M;c.push({name:"ADescriptionsItem",attribute:{title:s.label,span:s.span},content:{default:[(M=o.attribute.data[s.field])!=null?M:"--"],label:[s.label]}})}),o.content.default=c}else o.attribute[r]=t[r];e.drawingMain.ref.forceUpdate(),e.isSave=!1}function k(o,a){o.forEach(t=>{let r;if(typeof t=="object"){if(t.name=="AFormItem"){const c=e.drawingMain.component;let s=t.content.default[0].attribute.drawingForm;e.settingFormList.push(s);let M=s.bindAttribute.model;Fe(s.bind[M],s.attribute.exceptField||[]);const _=c.bindAttribute.model,H=c.bind[_];s.bind[M].default=H[s.bind[M].field],a.push(s.bind[M]),r=s.bind[M]}else if(t.name=="DraggableRender")k(t.attribute.list,a);else if(["ARow","ACol","ExFormMany","ATabs","ATabPane","ADivider"].indexOf(t.name)>-1){let c=t.attribute.drawingForm,s=c.bindAttribute.model;Fe(c.bind[s],c.attribute.exceptField||[]),a.push(c.bind[s]),r=c.bind[s]}t.content&&t.content.default&&r&&(r.content=[],k(t.content.default,r.content))}})}function y(o=!1){o&&(e.previewVisible=!1),e.settingFormList=[],U(),setTimeout(()=>{e.saveConfig={};const a=e.drawingMain.component;let t=a.attribute.drawingForm.bindAttribute.model;if(e.saveConfig.config=a.attribute.drawingForm.bind[t],a.name=="ExForm"){e.saveConfig.type="form",e.saveConfig.component=[],k(a.content.default,e.saveConfig.component);let r=0;Pe(()=>{e.settingFormList.forEach(c=>{i[c.bindAttribute.ref].form.validate().then(()=>{r++,r==e.settingFormList.length&&Y(o)}).catch(s=>{s.errorFields.length===0&&(r++,r==e.settingFormList.length&&Y(o)),s.errorFields.forEach(M=>{let _=`\u3010${s.values.title}\u3011`||"\u3010\u3011";we.error(_+M.errors[0]),e.settingFormList=[]})})})})}else a.name=="ExGrid"?(e.saveConfig.type="grid",Y(o)):a.name=="ADescriptions"&&(e.saveConfig.type="detail",Y(o))},500)}function g(o,a){return new Promise(t=>{I({url:"ex-admin/plugin-curd-controller-Index/getHistory",method:"post",data:{class:e.controller[e.controllerIndex].class,method:e.method[e.methodIndex].name,page:o,size:a}}).then(r=>{t(r.data)})})}function J(o){return new Promise(a=>{I({url:"ex-admin/plugin-curd-controller-Index/saveCode",method:"post",data:{id:e.method[e.methodIndex].id,controller:e.controller[e.controllerIndex].name,class:e.controller[e.controllerIndex].class,function:e.method[e.methodIndex].name,setting:e.saveConfig,code:o}}).then(t=>{e.settingFormList=[],Q(e.methodIndex),e.isSave=!0,a()})})}function Y(o){I({url:"ex-admin/plugin-curd-controller-Index/"+(o?"preview":"save"),method:"post",data:{id:e.method[e.methodIndex].id,controller:e.controller[e.controllerIndex].name,class:e.controller[e.controllerIndex].class,function:e.method[e.methodIndex].name,setting:e.saveConfig}}).then(a=>{e.settingFormList=[],o?(e.previewCode=a.data,e.previewVisible=!0):(Q(e.methodIndex),e.isSave=!0)})}function re(o){e.drawingMain.ref=o}function ne(){I("ex-admin/plugin-curd-controller-Index/getController?curd_ref="+u.attrs.curd_ref).then(o=>{e.controller=o.data.list,e.controllerForm=o.data.controllerForm})}function ie(){e.methodIndex=-1,I({url:"ex-admin/plugin-curd-controller-Index/getMethod",method:"post",data:{curd_ref:u.attrs.curd_ref,class:e.controller[e.controllerIndex].class,controller:e.controller[e.controllerIndex].name,table:e.controller[e.controllerIndex].table,id:e.controller[e.controllerIndex].id}}).then(o=>{e.methodForm=o.data.methodForm,e.method=o.data.list})}function F(){I({url:"ex-admin/plugin-curd-controller-Index/deleteMethod",method:"post",data:{class:e.controller[e.controllerIndex].class,controller:e.controller[e.controllerIndex].name,method:e.method[e.methodIndex].name,id:e.method[e.methodIndex].id}}).then(o=>{ie()})}function j(){const o=e.controller[e.controllerIndex];I({url:"ex-admin/plugin-curd-controller-Index/deleteController",method:"post",data:{id:o.id,path:o.path}}).then(a=>{e.controllerIndex=-1,ne(),e.method=[]})}function Q(o){e.methodIndex=o,e.settingForm=null,I({url:"ex-admin/plugin-curd-controller-Index/render",method:"post",data:{class:e.controller[e.controllerIndex].class,function:e.method[e.methodIndex].name,var:[]}}).then(a=>{e.isSave=!0,A(a.data),e.drawingMain.component=a.data})}function _e(o){if(!o.component)return;let a=te.exports.cloneDeep(o.component);if(a.name=="AFormItem"){let r=a.content.default[0].attribute.drawingForm,c=r.bind[r.bindAttribute.model];if(r.attribute.key=ue(20),c.field||(c.field=ue(20)),a.attribute.validateFormField=e.drawingMain.component.bindAttribute.validateField,a.content.default[0].name=="ExFormMany"){let s=[];a.content.default[0].content={default:v(a.content.default[0].name,s,a.content.default[0])}}}let t=[];if(a.name=="ARow"){let r=[];a.content.default[0].content={default:v("ACol",r)},t=a.content.default,a.content={default:v(a.name,t,a)}}else if(a.name=="ACol")a.content={default:v(a.name,t,a)};else if(a.name=="ATabs"){let r=a.content.default[0];r.content={default:v("ATabPane",t,r)},a.content={default:[r]}}return a}function se(o){o.from!==o.to&&!o.item._underlying_vm_&&we.warn("\u8BF7\u7F16\u8F91\u5B57\u6BB5\u914D\u7F6E\u5C5E\u6027\u518D\u8FDB\u884C\u62D6\u62FD"),V()}function Ee(o){if(o){const a=e.controller[e.controllerIndex];e.controllerEditForm=te.exports.cloneDeep(e.controllerForm);let t=e.controllerEditForm.content.content[0].attribute.params;t.id=a.id,t.class=a.class,t.path=a.path,t.title=a.title,t.name=a.name,t.table=a.table}}function Te(o){if(o){const a=e.method[e.methodIndex];e.methodEditForm=te.exports.cloneDeep(e.methodForm);let t=e.methodEditForm.content.content[0].attribute.params;t.id=a.id,t.type=a.type,t.name=a.name,t.oldName=a.name,t.oldTitle=a.title}}return ce({curdMethod:{onEnd:se,onClone:_e,saveCodeRequest:J,getHistory:g},onMove:B,onCloneMove:P,onEnd:se,onClone:_e,getController:ne,watchModel:T,dragSave:y,getRender:Q,getMethod:ie,deleteMethod:F,deleteController:j,controllerFormVisible:Ee,methodFormVisible:Te,dragRef:z,drawingRef:G,setRef:re},ke(e))}}),pe=n=>(Ie("data-v-ab3a60fc"),n=n(),Re(),n),yt={style:{position:"fixed","z-index":"9999999",bottom:"50px",left:"50px"}},Ft=$(" \u6DFB\u52A0 "),xt=$(" \u7F16\u8F91 "),Ct=$(" \u5220\u9664 "),wt={class:"flex-column"},Mt={class:"title"},kt=pe(()=>f("span",null,"\u63A7\u5236\u5668",-1)),It={class:"flex-1-auto"},Rt=["onContextmenu","onClick"],At={class:"name"},Et={class:"desc"},Tt=$(" \u6DFB\u52A0 "),Dt=$(" \u7F16\u8F91 "),Ot=$(" \u5220\u9664 "),$t={class:"flex-column"},Vt={class:"title"},Lt=pe(()=>f("span",null,"\u65B9\u6CD5",-1)),St={class:"flex-1-auto"},zt=["onContextmenu","onClick"],Nt={class:"name"},Pt={class:"desc"},Bt={class:"components"},Ut={style:{display:"flex","align-items":"center",margin:"5px"}},jt=pe(()=>f("i",{class:"fas fa-layer-group"},null,-1)),Ht={style:{"margin-left":"5px"}},qt={class:"components-draggable"},Wt={class:"components-item"},Kt={class:"components-body"},Gt={class:"header"},Jt={key:0},Xt=$("(ctrl+s)"),Zt=$("\u9884\u89C8\u4EE3\u7801"),Qt={class:"drawing ex_scrollbar",ref:"drawingRef"},Yt={style:{display:"none"}};function en(n,u,i,e,z,G){const N=p("database"),S=p("a-drawer"),R=p("database-filled"),E=p("a-button"),T=p("a-tooltip"),K=p("PlusOutlined"),A=p("render"),P=p("a-menu-item"),B=p("EditOutlined"),C=p("question-circle-outlined"),v=p("DeleteOutlined"),U=p("a-popconfirm"),m=p("a-menu"),b=p("ReloadOutlined"),V=p("a-dropdown"),k=p("a-layout-sider"),y=p("draggable"),g=p("a-tab-pane"),J=p("a-tabs"),Y=p("code-diff"),re=p("reload-outlined"),ne=p("a-layout-content"),ie=p("a-layout");return x(),O(ie,{class:"layout",id:"curd-layout"},{default:d(()=>[f("div",yt,[l(S,{class:"database-drawer",title:"\u6570\u636E\u5E93",width:300,mask:!1,placement:"left",visible:n.databaseDrawerVisible,"onUpdate:visible":u[1]||(u[1]=F=>n.databaseDrawerVisible=F)},{default:d(()=>[l(N,{method:n.curdMethod,visible:n.databaseDrawerVisible,"onUpdate:visible":u[0]||(u[0]=F=>n.databaseDrawerVisible=F)},null,8,["method","visible"])]),_:1},8,["visible"]),n.databaseDrawerVisible?q("",!0):(x(),O(T,{key:0,title:"\u6570\u636E\u5E93"},{default:d(()=>[l(E,{shape:"circle",onClick:u[2]||(u[2]=X(F=>n.databaseDrawerVisible=!0,["stop"]))},{icon:d(()=>[l(R)]),_:1})]),_:1}))]),l(k,{width:130,class:"controller ex_scrollbar"},{default:d(()=>[l(V,{trigger:["contextmenu"],onVisibleChange:n.controllerFormVisible},{overlay:d(()=>[l(m,null,{default:d(()=>[l(P,null,{default:d(()=>[l(A,{data:n.controllerForm},{default:d(()=>[l(K),Ft]),_:1},8,["data"])]),_:1}),n.controllerIndex>-1?(x(),O(P,{key:0},{default:d(()=>[l(A,{data:n.controllerEditForm},{default:d(()=>[l(B),xt]),_:1},8,["data"])]),_:1})):q("",!0),n.controllerIndex>-1?(x(),O(U,{key:1,title:"\u786E\u8BA4\u5220\u9664\uFF1F",onConfirm:u[3]||(u[3]=F=>n.deleteController())},{icon:d(()=>[l(C,{style:{color:"red"}})]),default:d(()=>[l(P,null,{icon:d(()=>[l(v)]),default:d(()=>[Ct]),_:1})]),_:1})):q("",!0)]),_:1})]),default:d(()=>[f("div",wt,[f("div",Mt,[kt,f("div",null,[l(A,{data:n.controllerForm},null,8,["data"]),l(E,{size:"small",shape:"circle",onClick:n.getController},{icon:d(()=>[l(b)]),_:1},8,["onClick"])])]),f("ul",It,[(x(!0),W(oe,null,le(n.controller,(F,j)=>(x(),W("li",{key:j,onContextmenu:X(Q=>n.controllerIndex=j,["prevent"]),onClick:Q=>{n.controllerIndex=j,n.getMethod()},class:ae(n.controllerIndex==j?"active":"")},[l(T,{placement:"bottom",mouseEnterDelay:1},{title:d(()=>[$(L(F.title),1)]),default:d(()=>[f("div",At,L(F.title),1)]),_:2},1024),l(T,{placement:"bottom",mouseEnterDelay:1},{title:d(()=>[$(L(F.path),1)]),default:d(()=>[f("div",Et,L(F.name),1)]),_:2},1024)],42,Rt))),128))])])]),_:1},8,["onVisibleChange"])]),_:1}),l(k,{width:130,class:"controller ex_scrollbar"},{default:d(()=>[l(V,{trigger:["contextmenu"],onVisibleChange:n.methodFormVisible},{overlay:d(()=>[l(m,null,{default:d(()=>[n.controllerIndex>-1?(x(),O(P,{key:0},{default:d(()=>[l(A,{data:n.methodForm},{default:d(()=>[l(K),Tt]),_:1},8,["data"])]),_:1})):q("",!0),n.methodIndex>-1?(x(),O(P,{key:1},{default:d(()=>[l(A,{data:n.methodEditForm},{default:d(()=>[l(B),Dt]),_:1},8,["data"])]),_:1})):q("",!0),n.methodIndex>-1?(x(),O(U,{key:2,title:"\u786E\u8BA4\u5220\u9664\uFF1F",onConfirm:u[4]||(u[4]=F=>n.deleteMethod())},{icon:d(()=>[l(C,{style:{color:"red"}})]),default:d(()=>[l(P,null,{icon:d(()=>[l(v)]),default:d(()=>[Ot]),_:1})]),_:1})):q("",!0)]),_:1})]),default:d(()=>[f("div",$t,[f("div",Vt,[Lt,f("div",null,[l(A,{disabled:n.controllerIndex==-1,data:n.methodForm},null,8,["disabled","data"]),l(E,{size:"small",shape:"circle",onClick:u[5]||(u[5]=F=>n.getMethod())},{icon:d(()=>[l(b)]),_:1})])]),f("ul",St,[(x(!0),W(oe,null,le(n.method,(F,j)=>(x(),W("li",{key:j,onContextmenu:X(Q=>n.methodIndex=j,["prevent"]),onClick:Q=>n.getRender(j),class:ae(n.methodIndex==j?"active":"")},[l(T,{placement:"bottom",mouseEnterDelay:1},{title:d(()=>[$(L(F.title),1)]),default:d(()=>[f("div",Nt,L(F.title),1)]),_:2},1024),l(T,{placement:"bottom",mouseEnterDelay:1},{title:d(()=>[$(L(F.name),1)]),default:d(()=>[f("div",Pt,L(F.name),1)]),_:2},1024)],42,zt))),128))])])]),_:1},8,["onVisibleChange"])]),_:1}),l(k,{width:300,class:"ex_scrollbar",ref:"dragRef"},{default:d(()=>[l(J,{type:"card",class:"curd-tabs"},{default:d(()=>[l(g,{key:"2",tab:"\u8868\u5355\u8BBE\u8BA1",forceRender:""},{default:d(()=>[(x(!0),W(oe,null,le(n.componentList,F=>(x(),W("div",Bt,[f("div",Ut,[jt,f("div",Ht,L(F.label),1)]),f("div",qt,[l(y,{list:F.options,sort:!1,clone:n.onClone,onEnd:n.onEnd,move:n.onCloneMove,"chosen-class":"chosen-class",group:{name:"components",pull:"clone",put:!1}},{item:d(({element:j})=>[f("div",Wt,[f("div",Kt,[f("i",{class:ae(j.icon)},null,2),$(" "+L(j.label),1)])])]),_:2},1032,["list","clone","onEnd","move"])])]))),256))]),_:1})]),_:1})]),_:1},512),l(ne,{class:"main"},{default:d(()=>[f("div",Gt,[n.methodIndex>-1?(x(),W("div",Jt,[l(E,{onClick:u[6]||(u[6]=F=>n.dragSave(!1))},{default:d(()=>[f("span",{style:Be(n.isSave?"":"color: red;")},"\u4FDD\u5B58",4),Xt]),_:1}),l(E,{onClick:u[7]||(u[7]=F=>n.dragSave(!0))},{default:d(()=>[Zt]),_:1}),l(Y,{code:n.previewCode,method:n.curdMethod},null,8,["code","method"])])):q("",!0),f("div",null,[l(E,{shape:"circle",size:"small",onClick:u[8]||(u[8]=F=>n.getRender(n.methodIndex))},{icon:d(()=>[l(re)]),_:1}),l(A,{data:n.$attrs.setting},null,8,["data"])])]),f("div",Qt,[l(A,{ref:F=>n.setRef(F),data:n.drawingMain.component},null,8,["data"])],512)]),_:1}),f("div",{class:"collapse",onClick:u[9]||(u[9]=F=>n.settingFormVisible=!n.settingFormVisible)},[f("i",{class:ae(n.settingFormVisible?"fas fa-angle-double-right":"fas fa-angle-double-left")},null,2)]),n.settingFormVisible?(x(),O(k,{key:0,width:360,class:"settingForm ex_scrollbar"},{default:d(()=>[l(J,{type:"card",class:"curd-tabs"},{default:d(()=>[n.settingForm?(x(),O(g,{key:"1",tab:"\u7EC4\u4EF6\u5C5E\u6027"},{default:d(()=>[l(A,{data:n.settingForm,onWatchModel:n.watchModel},null,8,["data","onWatchModel"])]),_:1})):q("",!0),l(g,{key:"2",tab:"\u5C5E\u6027",forceRender:""},{default:d(()=>[n.drawingMain.component?(x(),O(A,{key:0,data:n.drawingMain.component.attribute.drawingForm,onWatchModel:n.watchModel},null,8,["data","onWatchModel"])):q("",!0)]),_:1})]),_:1})]),_:1})):q("",!0),f("div",Yt,[(x(!0),W(oe,null,le(n.settingFormList,F=>(x(),O(A,{data:F,onWatchModel:n.watchModel},null,8,["data","onWatchModel"]))),256))])]),_:1})}var Jn=fe(vt,[["render",en],["__scopeId","data-v-ab3a60fc"]]);export{Jn as default};
